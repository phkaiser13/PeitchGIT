#!/bin/sh
#
# /* Copyright (C) 2025 Pedro Henrique / phkaiser13
# * File: postrm
# * This is the post-removal maintainer script for the 'phgit' Debian package.
# * It is executed by dpkg after the package's files have been removed. Its primary
# * role is to perform cleanup actions. Specifically, when the package is 'purged',
# * this script will remove any system-wide configuration, cache, or state files
# * that were generated by the application, ensuring a complete and clean removal.
# * SPDX-License-Identifier: Apache-2.0 */

# Exit immediately if a command exits with a non-zero status.
set -e

# Define the directory for application's persistent state data.
# Using /var/lib is standard for state files that are not user-specific.
APP_STATE_DIR="/var/lib/phgit"

# The first argument ($1) to this script indicates the action being performed.
# We are interested in the 'purge' action.
case "$1" in
    purge)
        echo "Purging phgit system-wide state files..."
        # The 'purge' command signifies that the user wants to remove everything,
        # including configuration and data files.
        # We check if the state directory exists before attempting to remove it.
        if [ -d "$APP_STATE_DIR" ]; then
            # The 'rm -rf' command will recursively and forcefully remove the directory.
            # This is safe because we are targeting a specific, known application directory.
            rm -rf "$APP_STATE_DIR"
            echo "Removed ${APP_STATE_DIR}."
        fi
        ;;

    remove|upgrade|failed-upgrade|abort-install|abort-upgrade)
        # For other actions, we do nothing. On a simple 'remove', configuration
        # and state files are intentionally left behind in case of reinstallation.
        ;;

    *)
        echo "postrm called with unknown argument \`$1'" >&2
        exit 1
        ;;
esac

# This line is a hook for debhelper. It will automatically add snippets
# of shell code from /usr/share/debhelper/autoscripts to this script.
# It's good practice to keep it at the end.
#DEBHELPER#

exit 0